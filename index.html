<html>
	<head>
		<title> Shift Escape </title>
		
			<style> canvas {width:100%, height: 100%} </style>
		
		<script src="js/three.js"></script>
		<script src="js/jquery.js"></script>
			
		<script src="Player/Player.js"></script>
		<script src="Grid/Grid.js"></script>
		
	</head>
	<body>	
	
		<script>
		
		var Game = function(){ 
			
			this.camera =  new THREE.PerspectiveCamera(45, 4.0/3.0, 1, 10000);
			this.renderer = new THREE.WebGLRenderer({antialias: true});
			this.scene = new THREE.Scene();
			
			this.grid = new Grid(8, this.scene); 
			
			this.animating = false;
		}
		
		Game.prototype.init = function(){
			var that = this;
			
      		this.renderer.setSize(800, 600);
      		document.body.appendChild(this.renderer.domElement);			
			this.renderer.setClearColorHex(0xEEEEEE, 1.0);
      		this.renderer.clear();
      		
			this.camera.position.y = 300;
			this.camera.position.x = 120;
			this.camera.position.z = -500;
			
			this.renderer.render(this.scene, this.camera);
      		
      		this.spot = new THREE.SpotLight();
      		this.spot.position.set( 530, 350, 530 );
      		this.scene.add(this.spot);
      		
      		this.grid.fillTile(3,2);
      			
      		
      		
      		//setup keyboard events
      		this.keys = {};
  			$('body').keydown(function(e) {
    		if (e.which && that.keys[e.which] !== 'triggered') {
    		  that.keys[e.which] = true;
    		}
  			});
  			$('body').keyup(function(e) {
    		if (e.which) {
    		  that.keys[e.which] = false;
    		}
  			});
		}
		
		Game.prototype.inputHandler = function(){
			var that = this;
			var string;
			if(this.keys[38]===true){
				string = "up";
				if(this.grid.selector.canMove(string)){
					this.keys[38] = "triggered";
					this.grid.selector.shiftUp();
				}
				
			}
			if(this.keys[40]===true){
				string = "down";
				if(this.grid.selector.canMove(string)){
					this.keys[40] = "triggered";
					this.grid.selector.shiftDown();					
				}

			}
			if(this.keys[37]===true){
				string = "left";
				if(this.grid.selector.canMove(string)){
					this.keys[37] = "triggered";
					this.grid.selector.shiftLeft();
				}
				
			}
			if(this.keys[39]===true){
				string = "right";
				if(this.grid.selector.canMove(string)){
					this.keys[39] = "triggered";
					this.grid.selector.shiftRight();
				}
				
			}
			
			if(this.keys[87]){
				string = "up";
				this.keys[87] = "triggered";
				if(this.grid.canMove(string)){
					this.grid.setAnimation(string);
					this.animating = true;
				}
			}
			if(this.keys[83]){
				string = "down";
				this.keys[83] = "triggered";
				if(this.grid.canMove(string)){
					this.grid.setAnimation(string);
					this.animating = true;
				}
				
			}
			if(this.keys[65]){
				string = "left";
				this.keys[65] = "triggered";
				if(this.grid.canMove(string)){
					this.grid.setAnimation(string);
					this.animating = true;
				}
				
			}
			if(this.keys[68]){
				string = "right";
				this.keys[68] = "triggered";
				if(this.grid.canMove(string)){
					this.grid.setAnimation(string);
					this.animating = true;
				}
				
			}
			
			if(this.keys[13]===true){ //horizontal shift
				string = "horizontal"
				this.keys[13] = "triggered";
				if(this.grid.canShift(string)){
					this.grid.horizontalShift();
					this.animating = true;
				}
				
			}
			if(this.keys[16]===true){ //vertical shift
				string = "vertical";
				this.keys[16] = "triggered";
				if(this.grid.canShift(string)){
					this.grid.verticalShift();
					this.animating = true;
				}
				
			}
		}
		
		var game = new Game();
		
		function start(t){
			var that = game;
			that.camera.position.x = 120 + Math.sin(t/10000)*200;
        	that.camera.position.y = 300 + Math.sin(t/10000)*50;
			that.camera.lookAt(new THREE.Vector3(220, 0, 220));
			that.renderer.render(that.scene, that.camera);
			if(!that.animating) {
				that.inputHandler();
			}
			else {
				if(!that.grid.animate()) that.animating = false;
			}
        	window.requestAnimationFrame(start, that.renderer.domElement);
		}
		
		var t = new Date().getTime();
		
		
		game.init();
		start(t);
		
		
		
      	
		
		</script>	
	</body>
	
	
</html>